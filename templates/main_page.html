{% extends "base.html" %}

{% block content %}

{% if countdown %}
  <div class="alert alert-danger">
    â³ <strong>Countdown:</strong> {{ countdown }}
  </div>
{% endif %}

<h2>ğŸ“… Meine Termine</h2>

<ul class="termin-list">
  {% for termin in termins %}
    <li class="termin-item">

      
      <div class="termin-info">
        <strong>{{ termin.title }}</strong><br>

        <div class="termin-meta">
          <span>ğŸ“… {{ termin.date.strftime('%d.%m.%Y') }}</span>
          <span>â° {{ termin.time_str }}</span>
        </div>

        {% if termin.is_exam %}
          <div class="exam-box">
            <span class="badge">ğŸ“ PrÃ¼fung</span>

            <div
              class="countdown"
              data-date="{{ termin.date }}"
              data-time="{{ termin.time_str }}">
              â³ Lade Countdown...
            </div>
          </div>
        {% endif %}
      </div>



        {% if termin.is_exam %}
          <span class="badge">ğŸ“ PrÃ¼fung</span>
        {% endif %}
      </div>

      <div class="termin-actions">
        <!-- Termin lÃ¶schen -->
        <form action="/delete_termin" method="POST" style="display:inline;">
          <input type="hidden" name="id" value="{{ termin.id }}">
          <button type="submit">âŒ</button>
        </form>

        <a href="{{ url_for('edit_termin', id=termin.id) }}" class="btn btn-xs btn-warning">
          âœï¸
        </a>



        
        <!-- Als PrÃ¼fung markieren -->
        <form action="/mark_exam" method="POST" style="display:inline;">
  <input type="hidden" name="id" value="{{ termin.id }}">

  {% if termin.is_exam %}
    <button type="submit" title="PrÃ¼fung entfernen">âŒğŸ“</button>
  {% else %}
    <button type="submit" title="Als PrÃ¼fung markieren">ğŸ“</button>
  {% endif %}
</form>
      </div>

    </li>
  {% else %}
    <p>Keine Termine vorhanden ğŸ‰</p>
  {% endfor %}
</ul>

<hr>

<h3>â• Neuen Termin erstellen</h3>

<form action="." method="POST" class="termin-form">

  <div class="form-group">
    <label for="title">Titel</label>
    <input
      type="text"
      id="title"
      name="title"
      class="form-control"
      placeholder="z. B. MatheprÃ¼fung"
      required>
  </div>

  <div class="form-group">
    <label for="date">Datum</label>
    <input
      type="date"
      id="date"
      name="date"
      class="form-control"
      required>
  </div>

  <div class="form-group">
    <label for="time">Uhrzeit</label>
    <input
      type="time"
      id="time"
      name="time"
      class="form-control"
      required>
  </div>

  <button type="submit" class="btn btn-primary">Termin erstellen</button>
</form>



<script>
function updateCountdowns() {
  const countdowns = document.querySelectorAll(".countdown");

  countdowns.forEach(cd => {
    const date = cd.dataset.date;
    const time = cd.dataset.time;

    const target = new Date(date + "T" + time);
    const now = new Date();
    const diff = target - now;

    if (diff <= 0) {
      cd.innerHTML = "âœ… Termin vorbei";
      return;
    }

    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((diff / (1000 * 60)) % 60);
    const seconds = Math.floor((diff / 1000) % 60);

    cd.innerHTML =
      `â³ ${days}d ${hours}h ${minutes}m ${seconds}s`;
  });
}

// sofort starten
updateCountdowns();
// jede Sekunde aktualisieren
setInterval(updateCountdowns, 1000);
</script>


{% endblock %}